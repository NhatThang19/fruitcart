<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{admin/layouts/admin-layout}">

<head>
    <title th:text="${pageMetadata.title}"></title>
<body>
<div layout:fragment="content">
    <div th:fragment="page_link(page, text, disabledCondition, isActive)">
        <li class="page-item" th:classappend="${disabledCondition} ? 'disabled' : (${isActive} ? ' active' : '')">
            <a class="page-link" th:href="@{/admin/orders(page=${page}, size=${orderPage.size}, sort=${currentSortField != null ? currentSortField + ',' + currentSortDir : null}, keyword=${criteria.keyword}, status=${criteria.status}, fromDate=${criteria.fromDate}, toDate=${criteria.toDate})}" th:text="${text}"></a>
        </li>
    </div>

    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header"><h5 class="card-title">Danh sách Đơn hàng</h5></div>
                <div class="card-body">
                    <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
                    <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

                    <form th:action="@{/admin/orders}" method="get" class="mb-4" th:object="${criteria}">
                        <div class="row g-3 align-items-end">
                            <div class="col-md-4"><label class="form-label">Tìm kiếm</label><input type="text" class="form-control form-control-sm" th:field="*{keyword}" placeholder="Mã ĐH hoặc Tên khách..."></div>
                            <div class="col-md-2"><label class="form-label">Trạng thái</label><select class="form-select form-select-sm" th:field="*{status}"><option value="">Tất cả</option><option th:each="st : ${statuses}" th:value="${st}" th:text="${st.displayName}"></option></select></div>
                            <div class="col-md-2"><label class="form-label">Từ ngày</label><input type="date" class="form-control form-control-sm" th:field="*{fromDate}"></div>
                            <div class="col-md-2"><label class="form-label">Đến ngày</label><input type="date" class="form-control form-control-sm" th:field="*{toDate}"></div>
                            <div class="col-md-2"><button type="submit" class="btn btn-primary btn-sm w-100">Lọc</button></div>
                        </div>
                    </form>

                    <div class="table-responsive">
                        <table class="table table-hover table-bordered align-middle">
                            <thead class="table-light">
                            <tr>
                                <th>Mã ĐH</th>
                                <th>Khách hàng</th>
                                <th>Ngày đặt</th>
                                <th class="text-end">Tổng tiền</th>
                                <th class="text-center">Trạng thái</th>
                                <th class="text-center">Hành động</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="order : ${orderPage.content}">
                                <td class="fw-semibold" th:text="'#' + ${order.id}"></td>
                                <td th:text="${order.customerName}"></td>
                                <td th:text="${#temporals.format(order.createdDate, 'dd/MM/yyyy HH:mm')}"></td>
                                <td class="text-end fw-bold" th:text="${#numbers.formatCurrency(order.totalAmount)}"></td>
                                <td class="text-center"><span class="badge" th:classappend="${order.status.badgeClass}" th:text="${order.status.displayName}"></span></td>
                                <td class="text-center"><a th:href="@{/admin/orders/{id}(id=${order.id})}" class="btn btn-sm btn-info" title="Xem chi tiết"><i class="ri-eye-line"></i></a></td>
                            </tr>
                            <tr th:if="${orderPage.isEmpty()}">
                                <td colspan="6" class="text-center fst-italic py-4">Không tìm thấy đơn hàng nào.</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <nav th:if="${orderPage.totalPages > 1}">
                        <ul class="pagination justify-content-center">
                            <th:block th:replace="~{this :: page_link(${orderPage.number - 1}, 'Trước', ${!orderPage.hasPrevious()}, false)}" />
                            <th:block th:each="i : ${#numbers.sequence(0, orderPage.totalPages - 1)}"><th:block th:if="${i >= orderPage.number - 2 && i <= orderPage.number + 2}"><th:block th:replace="~{this :: page_link(${i}, ${i + 1}, false, ${i == orderPage.number})}" /></th:block></th:block>
                            <th:block th:replace="~{this :: page_link(${orderPage.number + 1}, 'Sau', ${!orderPage.hasNext()}, false)}" />
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

</body>

</html>